---

- name: Install i3 keyring
  apt:
    name: sur5r-keyring
    allow_unauthenticated: yes
    update_cache: yes
    cache_valid_time: 3600
    state: latest
  become: yes

- name: Install Debian packages
  apt:
    name: "{{ item.package }}"
    update_cache: yes
    cache_valid_time: 3600
    state: latest
    install_recommends: no
  become: yes
  with_items:
    - { package: "ruby2.4" }
    - { package: "ruby2.4-dev" }
    - { package: "build-essential" }
    - { package: "git" }
    - { package: "i3" }
    - { package: "redshift-gtk" }
    - { package: "gnome-encfs-manager" }
    - { package: "gnome-terminal" }
    - { package: "autossh" }
    - { package: "compton" }
    - { package: "unclutter" }
    - { package: "urlscan" }
    - { package: "mutt" }
    - { package: "docker-ce" }
    - { package: "riot-web" }
    - { package: "numix-gtk-theme" }
    - { package: "numix-icon-theme" }
    - { package: "owncloud-client" }
    - { package: "feh" }
    - { package: "gnupg" }
    - { package: "transmission-gtk" }
    - { package: "neovim" }
    - { package: "unzip" }
    - { package: "dkms" }
    - { package: "virtualbox-5.1" }
    - { package: "pass" }
    - { package: "libdbus-glib-1-dev" }
    - { package: "whois" }
    - { package: "htop" }
    - { package: "mpv" }
    - { package: "i965-va-driver" }
    - { package: "vdpau-va-driver" }
    - { package: "golang-1.8" }
    - { package: "curl" }
    - { package: "jq" }
    - { package: "network-manager-openvpn-gnome" }
    - { package: "network-manager-openconnect-gnome" }
    - { package: "unrar" }
    - { package: "w3m" }
    - { package: "yarn" }
    - { package: "gimp" }
    - { package: "slack-desktop" }
    - { package: "pinentry-curses" }
    - { package: "libsecret-1-dev" }
    - { package: "clang-tidy-5.0" }
    - { package: "clang-format-5.0" }
    - { package: "libclang-common-5.0-dev" }
    - { package: "azure-cli" }

- name: Install libsecret git helper
  command: make
  become: True
  args:
    chdir: /usr/share/doc/git/contrib/credential/libsecret/
    creates: /usr/share/doc/git/contrib/credential/libsecret/git-credential-libsecret

- stat:
    path: /usr/bin/google-chrome
  register: google

- name: Install Google Chrome
  apt: deb=https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
  become: yes

- name: Install Microsoft Core Fonts
  apt: deb=http://ftp.debian.org/debian/pool/contrib/m/msttcorefonts/ttf-mscorefonts-installer_3.6_all.deb
  become: yes

- name: Install gopass
  apt: deb=https://github.com/justwatchcom/gopass/releases/download/v{{ gopass_version }}/gopass-{{ gopass_version }}-linux-amd64.deb
  become: yes

- name: Install ctop
  get_url:
    url: https://github.com/bcicen/ctop/releases/download/v{{ ctop_version }}/ctop-{{ ctop_version }}-linux-amd64
    dest: "{{ ansible_env.HOME }}/.local/bin/ctop"
    checksum: "sha256:5313c4e2f98639cce53545762f0b65f3db977ae764a9acb2fb15928713b8cde0"
    mode: 0755

- name: Remove Debian packages
  apt:
    name: "{{ item.package }}"
    purge: yes
    state: absent
  become: yes
  with_items:
    - { package: "thunderbird" }
    - { package: "pidgin" }

- name: Install Python packages
  pip:
    name: "{{ item.package }}"
    extra_args: --user
    state: latest
  with_items:
    - { package: "pip" }
    - { package: "setuptools" }
    - { package: "keyring" }
    - { package: "awscli" }
    - { package: "streamlink" }
    - { package: "neovim" }
    - { package: "secretstorage" }
    - { package: "dbus-python" }
    - { package: "flake8" }

- name: Install pip3
  apt:
    name: python3-pip
    update_cache: yes
    cache_valid_time: 3600
    state: latest
    install_recommends: no
  become: yes

- name: Install Python3 packages
  pip:
    name: "{{ item.package }}"
    extra_args: --user
    state: latest
    executable: /usr/bin/pip3
  with_items:
    - { package: "neovim" }

- name: Install Rubygems
  gem:
    name: "{{ item.package }}"
    user_install: no
  become: yes
  with_items:
    - { package: "bundler" }
    - { package: "neovim" }

- name: Install local Rubygems
  gem:
    name: "{{ item.package }}"
    user_install: yes
  with_items:
    - { package: "rubocop" }

- name: Install awstools
  get_url:
    url: "https://github.com/sam701/awstools/releases/download/{{ awstools_version }}/awstools_linux_amd64"
    dest: "{{ ansible_env.HOME }}/.local/bin/awstools"
    sha256sum: c336f25889a55791f62fdef7ca034caad48be5d49745075138c7969fc38d1793
    mode: 0755

- name: Install minishift
  unarchive:
    src: "https://github.com/minishift/minishift/releases/download/v{{ minishift_version }}/minishift-{{ minishift_version }}-linux-amd64.tgz"
    dest: "{{ ansible_env.HOME }}/.local/bin/"
    remote_src: True
    creates: "{{ ansible_env.HOME }}/.local/bin/minishift"

- name: Install OpenShift client
  unarchive:
    src: "https://github.com/openshift/origin/releases/download/v{{ openshift_cli_version }}/openshift-origin-client-tools-v{{ openshift_cli_version }}-7b451fc-linux-64bit.tar.gz"
    dest: "{{ ansible_env.HOME }}/.local/bin/"
    exclude:
      - "*/LICENSE"
      - "*/README.md"
    extra_opts: "--strip-components=1"
    remote_src: True
    creates: "{{ ansible_env.HOME }}/.local/bin/oc"

- name: Install Hugo
  apt: deb=https://github.com/gohugoio/hugo/releases/download/v0.24.1/hugo_0.24.1_Linux-64bit.deb
  become: yes

- name: Ruby alternative
  become: yes
  alternatives:
    name: ruby
    path: /usr/bin/ruby2.4

- name: Gem alternative
  become: yes
  alternatives:
    name: gem
    path: /usr/bin/gem2.4

- name: vim alternative
  become: yes
  alternatives:
    name: vim
    path: /usr/bin/nvim

- name: pinentry alternative
  become: yes
  alternatives:
    name: pinentry
    path: /usr/bin/pinentry-curses

- name: nodejs alternative
  become: yes
  alternatives:
    name: node
    link: /usr/bin/node
    path: /usr/bin/nodejs

- name: clang-format alternative
  become: yes
  alternatives:
    name: clang-format
    link: /usr/bin/clang-format
    path: /usr/bin/clang-format-5.0

- name: clang-tidy alternative
  become: yes
  alternatives:
    name: clang-tidy
    link: /usr/bin/clang-tidy
    path: /usr/bin/clang-tidy-5.0

- include: hashicorp.yml
- include: docker.yml
- include: golang.yml
